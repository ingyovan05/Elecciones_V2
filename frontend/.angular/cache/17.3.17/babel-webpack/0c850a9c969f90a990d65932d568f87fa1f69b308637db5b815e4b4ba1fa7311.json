{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { ReactiveFormsModule, Validators } from '@angular/forms';\nimport { CommonModule } from '@angular/common';\nimport { InputTextModule } from 'primeng/inputtext';\nimport { DropdownModule } from 'primeng/dropdown';\nimport { InputSwitchModule } from 'primeng/inputswitch';\nimport { CheckboxModule } from 'primeng/checkbox';\nimport { ButtonModule } from 'primeng/button';\nimport { RippleModule } from 'primeng/ripple';\nimport { switchMap } from 'rxjs';\nlet PersonFormComponent = class PersonFormComponent {\n  constructor(fb, catalog, api, messages) {\n    this.fb = fb;\n    this.catalog = catalog;\n    this.api = api;\n    this.messages = messages;\n    this.isAnonymous = false;\n    this.saved = new EventEmitter();\n    this.municipalities = [];\n    this.form = this.fb.nonNullable.group({\n      id: [''],\n      cedula: ['', Validators.required],\n      firstName: ['', Validators.required],\n      middleName: [''],\n      lastName: ['', Validators.required],\n      secondLastName: [''],\n      partyId: ['', Validators.required],\n      votesCongress: [false],\n      votesPresident: [false],\n      acceptsTerms: [false, Validators.requiredTrue],\n      departmentId: ['', Validators.required],\n      municipalityId: ['', Validators.required]\n    });\n  }\n  ngOnInit() {\n    this.catalog.loadInitial();\n    this.form.get('departmentId').valueChanges.pipe(switchMap(id => this.catalog.getMunicipalities(id))).subscribe(list => this.municipalities = list);\n  }\n  submit() {\n    if (this.form.invalid) return;\n    const value = this.form.getRawValue();\n    const endpoint = this.isAnonymous ? '/api/persons/anonymous' : '/api/persons';\n    this.api.post(endpoint, value).subscribe({\n      next: resp => {\n        if (resp.conflict) {\n          this.messages.add({\n            severity: 'warn',\n            summary: 'Registro existente',\n            detail: 'La persona ya estÃ¡ registrada, actualiza los datos.'\n          });\n          this.form.patchValue({\n            id: resp.person.id,\n            ...resp.person,\n            partyId: resp.person.party?.id,\n            departmentId: resp.person.department?.id,\n            municipalityId: resp.person.municipality?.id\n          });\n        } else {\n          this.messages.add({\n            severity: 'success',\n            summary: 'Registro guardado'\n          });\n          this.saved.emit(resp.person);\n          this.form.reset({\n            votesCongress: false,\n            votesPresident: false,\n            acceptsTerms: false\n          });\n        }\n      },\n      error: error => this.messages.add({\n        severity: 'error',\n        summary: 'Error',\n        detail: error.error?.message ?? 'No se pudo guardar'\n      })\n    });\n  }\n};\n__decorate([Input()], PersonFormComponent.prototype, \"isAnonymous\", void 0);\n__decorate([Output()], PersonFormComponent.prototype, \"saved\", void 0);\nPersonFormComponent = __decorate([Component({\n  selector: 'app-person-form',\n  standalone: true,\n  imports: [CommonModule, ReactiveFormsModule, InputTextModule, DropdownModule, InputSwitchModule, CheckboxModule, ButtonModule, RippleModule],\n  templateUrl: './person-form.component.html',\n  styleUrls: ['./person-form.component.scss']\n})], PersonFormComponent);\nexport { PersonFormComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}